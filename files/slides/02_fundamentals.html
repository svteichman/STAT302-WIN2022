<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>STAT 302, Lecture Slides 2</title>
    <meta charset="utf-8" />
    <meta name="author" content="Sarah Teichman (adapted from slides by Bryan Martin and Peter Gao)" />
    <link href="02_fundamentals_files/remark-css/default.css" rel="stylesheet" />
    <script src="02_fundamentals_files/kePrint/kePrint.js"></script>
    <link rel="stylesheet" href="gao-theme.css" type="text/css" />
    <link rel="stylesheet" href="gao-theme-fonts.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, title-slide

# STAT 302, Lecture Slides 2
## Programming Fundamentals
### Sarah Teichman (adapted from slides by Bryan Martin and Peter Gao)

---




# Today's pet picture 


&lt;img src="../../files/images/pets/joia_kittens.jpg" width="550px" style="display: block; margin: auto;" /&gt;

---

# Before class

Think about the results and check your answer in R:


```r
to_do_list &lt;- 
  list(saturday = c("sleep", "feed cat", "pet cat"),
       sunday = c("wake up", "homework", "course prep"))
# what are each of the following?
to_do_list[1]
to_do_list[1][1]
to_do_list[[1]]
to_do_list[1][[1]]
to_do_list[[1]][2]
```

---




```r
to_do_list[1]
```

```
## $saturday
## [1] "sleep"    "feed cat" "pet cat"
```

```r
to_do_list[1][1]
```

```
## $saturday
## [1] "sleep"    "feed cat" "pet cat"
```

```r
to_do_list[[1]]
```

```
## [1] "sleep"    "feed cat" "pet cat"
```

```r
to_do_list[1][[1]]
```

```
## [1] "sleep"    "feed cat" "pet cat"
```

```r
to_do_list[[1]][2]
```

```
## [1] "feed cat"
```


---


# Outline

1. Control flow: `if`, `else`, `while`
2. Loops: `for` and `while`
3. Functions
4. Packages
5. Data
6. Managing Data

.middler[**Goal:** Use R's programming capabilities to build efficient functions and workflows.]

---
class: inverse

.sectionhead[Part 1: Control Flow]
---
layout: true

# Control Flow
---

## `if` statements

* `if` statement give our computer conditions for chunks of code
* If our condition is `TRUE`, then the chunk evaluates
* If our condition is `FALSE`, then it does not
* We must give our condition as a single Boolean

---

## `if` statements


```r
x &lt;- 1
# Conditions go in parenthesis after if
if (x &gt; 0) {
  # code chunks get surrounded by curly brackets
  print(paste0("x is equal to ", x, ", a positive number!"))
}
```

--

```
## [1] "x is equal to 1, a positive number!"
```

---

## `if` statements

```r
x &lt;- -1
# Conditions go in parenthesis after if
if (x &gt; 0) {
  # code chunks get surrounded by curly brackets
  print(paste0("x is equal to ", x, ", a positive number!"))
}
```

---

## `else` statements

* We can use `else` to specify what we want to happen when our condition is `FALSE`


```r
x &lt;- 1
if (x &gt; 0) {
  print(paste0("x is equal to ", x, ", a positive number!"))
} else {
  print(paste0("x is equal to ", x, ", a negative number!"))
}
```

--


```
## [1] "x is equal to 1, a positive number!"
```

---

## `else` statements

* We can use `else` to specify what we want to happen when our condition is `FALSE`


```r
x &lt;- -1
if (x &gt; 0) {
  print(paste0("x is equal to ", x, ", a positive number!"))
} else {
  print(paste0("x is equal to ", x, ", a negative number!"))
}
```

```
## [1] "x is equal to -1, a negative number!"
```

---

## `else if`

* Use `else if` to set a sequence of conditions
* The final `else` will evaluate anything left


```r
x &lt;- 1
if (x &gt; 0) {
  paste0("x is equal to ", x, ", a positive number!")
} else if (x &lt; 0) {
  paste0("x is equal to ", x, ", a negative number!")
} else {
  paste0("x is equal to ", x, "!")
}
```

```
## [1] "x is equal to 1, a positive number!"
```

---

## `else if`


```r
x &lt;- -1
if (x &gt; 0) {
  paste0("x is equal to ", x, ", a positive number!")
} else if (x &lt; 0) {
  paste0("x is equal to ", x, ", a negative number!")
} else {
  paste0("x is equal to ", x, "!")
}
```

```
## [1] "x is equal to -1, a negative number!"
```

---

## `else if`


```r
x &lt;- 0
if (x &gt; 0) {
  paste0("x is equal to ", x, ", a positive number!")
} else if (x &lt; 0) {
  paste0("x is equal to ", x, ", a negative number!")
} else {
  paste0("x is equal to ", x, "!")
}
```

```
## [1] "x is equal to 0!"
```

---
layout: false
layout: true

# Control Flow: Examples
---

## Divisibility

Suppose we want to check if `x` is divisible by 5 and print out the answer. What should `CONDITION` be?


```r
x &lt;- 5
if (CONDITION) {
  IF TRUE, DO THIS
} else {
  ELSE, DO THIS
}
```
---

## Divisibility

Suppose we want to check if `x` is divisible by 5 and print out the answer. What should `CONDITION` be?


```r
x &lt;- 5
# modulo operator
if (x %% 5 == 0) {
  print("divisible by 5")
} else {
  print("not divisible by 5")
}
```

--

```
## [1] "divisible by 5"
```

---

## Check length of strings

Note: We will need the `stringr` package for this 

```r
# Run this if you have never installed stringr before!
# install.packages("stringr")
library(stringr)
```


```r
x &lt;- "cat"
if (str_length(x) &lt;= 10) {
  cat("x is a pretty short string!")
} else {
  cat("x is a pretty long string!")
}
```

```
## x is a pretty short string!
```

---



```r
x &lt;- "A big fluffy cat with orange fur and stripes"
if (str_length(x) &lt;= 10) {
  cat("x is a pretty short string!")
} else {
  cat("x is a pretty long string!")
}
```

```
## x is a pretty long string!
```

---

## Check class


```r
x &lt;- 5
if (is.numeric(x)) {
  cat("x is a numeric!")
} else if (is.character(x)) {
  cat("x is a character!")
} else {
  cat("x is some class I didn't check for in my code!")
}
```

```
## x is a numeric!
```

---

## Check class


```r
x &lt;- list()
if (is.numeric(x)) {
  cat("x is a numeric!")
} else if (is.character(x)) {
  cat("x is a character!")
} else {
  cat("x is some class I didn't check for in my code!")
}
```

```
## x is some class I didn't check for in my code!
```

---
layout: false
class: inverse

.sectionhead[Part 2: for loops]
---
layout: true

# Loops

---

## `for` loops

`for` loops iterate along an input vector, 
stores the current value of the vector as a variable,
and repeatedly evaluates a code chunk until the vector is exhausted


```r
for (i in 1:8) {
  print(i)
}
```

```
## [1] 1
## [1] 2
## [1] 3
## [1] 4
## [1] 5
## [1] 6
## [1] 7
## [1] 8
```

---

## `while` loops

`while` loops continuously evaluate the inner code chunk until the condition is `FALSE`.


Be careful here! It is possible to get stuck in an infinite loop!


```r
x &lt;- 0
while (x &lt; 5) {
  cat("x is currently", x, ". Let's increase it by 1!")
  x &lt;- x + 1
}
```

```
## x is currently 0 . Let's increase it by 1!x is currently 1 . Let's increase it by 1!x is currently 2 . Let's increase it by 1!x is currently 3 . Let's increase it by 1!x is currently 4 . Let's increase it by 1!
```

---

## `while` loops

Let's see if we can clean up that output. Add `"\n"` to a string to force a line break. 


```r
x &lt;- 0
while (x &lt; 5) {
  cat("x is currently ", x, ". Let's increase it by 1! \n", sep = "")
  x &lt;- x + 1
}
```

```
## x is currently 0. Let's increase it by 1! 
## x is currently 1. Let's increase it by 1! 
## x is currently 2. Let's increase it by 1! 
## x is currently 3. Let's increase it by 1! 
## x is currently 4. Let's increase it by 1!
```

---
layout: false
layout: true

# Loops: Examples
---

## String Input


```r
string_vector &lt;- c("a", "b", "c", "d", "e")
for (mystring in string_vector) {
  print(mystring)
}
```

```
## [1] "a"
## [1] "b"
## [1] "c"
## [1] "d"
## [1] "e"
```

---


## Nested Loops


```r
for (i in 1:3) {
  for (j in 1:2) {
    print(i * j)
  }
}
```

```
## [1] 1
## [1] 2
## [1] 2
## [1] 4
## [1] 3
## [1] 6
```

---

## Filling in a vector

Note: Usually, this is an inefficient way to do this! Try to vectorize code wherever possible!


```r
# Inefficient
x &lt;- rep(NA, 5)
for (i in 1:5) {
  x[i] &lt;- i * 2
}
x
```

```
## [1]  2  4  6  8 10
```

```r
# Much better
x &lt;- seq(2, 10, by = 2)
x
```

```
## [1]  2  4  6  8 10
```

---

## Filling in a matrix

Note: Usually, this is an inefficient way to do this! Try to vectorize code wherever possible!


```r
x &lt;- matrix(NA, nrow = 4, ncol = 3)
for (i in 1:4) {
  for (j in 1:3) {
    x[i, j] &lt;- i * j
  }
}
x
```

```
##      [,1] [,2] [,3]
## [1,]    1    2    3
## [2,]    2    4    6
## [3,]    3    6    9
## [4,]    4    8   12
```

---

## Continue until positive sample


```r
set.seed(3)
x &lt;- -1
while (x &lt; 0) {
  x &lt;- rnorm(1)
  print(x)
}
```

```
## [1] -0.9619334
## [1] -0.2925257
## [1] 0.2587882
```

```r
x
```

```
## [1] 0.2587882
```

---

## Your turn 

Write a loop to simulate flipping a fair coin until you get a head. Once you've done this, tell us in the chat how many flips it took to get a head.

---

## Your turn 


```r
counter &lt;- 0 
coin &lt;- 0 
while (coin == 0) {
  coin &lt;- sample(c(0,1), 1)
  # alternate way to do this
  # coin &lt;- rbinom(n = 1, size = 1, prob = 0.5)
  counter &lt;- counter + 1
}
counter
```

```
## [1] 1
```

---

layout: false
class: inverse

.sectionhead[Part 3: Functions]
---
layout: true

# Functions
---

We've already seen and used several functions, but you can also create your own!
This is incredibly useful when:

* You use the same code chunk repeatedly
* You want to generalize your workflow to multiple inputs
* You want others to be able to use your code
* You want to complete your assignments for STAT 302

---

## Anatomy of a function


```r
function_name &lt;- function(param1, param2 = "default") {
  # Body of the function
  return(output)
}
```

* `function_name`: the name you want to give your function, what you will use to call it
* `function()`: call this to define a function
* `param1`, `param2`: function parameters, what the user inputs. You can assign default values by setting them equal to something in the function definition
* **Body**: the actual code that is executed
* `return()`: is what your function will return to the user

---
layout: false
layout: true

# Functions: Examples
---

## Square a number, add 2


```r
square_plus_2 &lt;- function(x) {
  y &lt;- x^2 + 2
  return(y)
}

square_plus_2(4)
```

```
## [1] 18
```

```r
square_plus_2(10)
```

```
## [1] 102
```

```r
square_plus_2(1:5)
```

```
## [1]  3  6 11 18 27
```

---


```r
square_plus_2("some string")
```

```
## Error in x^2: non-numeric argument to binary operator
```

What happened here? We wrote a function for numerics only but didn't check the input!
 
---

Let's try making our function more robust by adding a `stop`


```r
square_plus_2 &lt;- function(x) {
  if (!is.numeric(x)) {
    stop("x must be numeric!")
  } else {
    y &lt;- x^2 + 2
    return(y)
  }
}

square_plus_2("some string")
```

```
## Error in square_plus_2("some string"): x must be numeric!
```


---

## Check if the input is positive


```r
check_pos &lt;- function(x) {
  if (x &gt; 0) {
    return(TRUE)
  } else if (x &lt; 0) {
    return(FALSE)
  } else {
    return(paste0("x is equal to ", x, "!"))
  }
}

check_pos(-3)
```

```
## [1] FALSE
```

```r
store_output &lt;- check_pos(0)
store_output
```

```
## [1] "x is equal to 0!"
```

---

## Make a table

We'll use `str_c` from the `stringr` package for this function, which joins multiple strings into a single string.


```r
library(stringr)
my_summary &lt;- function(input, percentiles = c(.05, .5, .95)) {
  if (!is.numeric(input) | !is.numeric(percentiles)) {
    stop("The input and percentiles must be numeric!")
  }
  if (max(percentiles) &gt; 1 | min(percentiles) &lt; 0) {
    stop("Percentiles must all be in [0, 1]")
  }
  # Convert percentiles to character percent, append " Percentile" to each
  labels &lt;- str_c(percentiles * 100, " Percentile")
  output &lt;- quantile(input, probs = percentiles)
  names(output) &lt;- labels
  return(output)
}
```

---

## Make a table


```r
x &lt;- rnorm(100)
my_summary(x)
```

```
##  5 Percentile 50 Percentile 95 Percentile 
##    -1.3297214    -0.1893119     1.3207927
```

```r
my_summary(x, percentiles = c(.07, .5, .63, .91))
```

```
##  7 Percentile 50 Percentile 63 Percentile 91 Percentile 
##    -1.2932186    -0.1893119     0.1209990     1.0829650
```

---

## Make a table


```r
my_summary(x, c("string1", "string2"))
```

```
## Error in my_summary(x, c("string1", "string2")): The input and percentiles must be numeric!
```

```r
my_summary(x, percentiles = c(-7, .5, 1.3))
```

```
## Error in my_summary(x, percentiles = c(-7, 0.5, 1.3)): Percentiles must all be in [0, 1]
```


---

## Function with iteration


```r
my_sum &lt;- function(x) {
  total &lt;- 0
  for (i in 1:length(x)) {
    total &lt;- total + x[i]
  }
  return(total)
}
my_sum(1:5)
```

```
## [1] 15
```


---

## Function with iteration

Want to know what's happening? Add a print statement! 


```r
my_sum &lt;- function(x) {
  total &lt;- 0
  for (i in 1:length(x)) {
    total &lt;- total + x[i]
    print(total)
  }
  return(total)
}
my_sum(1:5)
```

```
## [1] 1
## [1] 3
## [1] 6
## [1] 10
## [1] 15
```

```
## [1] 15
```

---

layout: false
class: inverse

.sectionhead[Style guide!]
---
layout: true

# Style guide!
---

.middler[Once again, we will using a mix of the [Tidyverse style guide](https://style.tidyverse.org/) and the [Google style guide](https://google.github.io/styleguide/Rguide.html).]

---

## Function Names

Strive to have function names based on verbs. 
Otherwise, standard variable name style guidelines apply!


```r
# Good
add_row()
permute()

# Bad
row_adder()
permutation()
```


---

## Spacing

Place a space before and after `()` when used with `if`, `for`, or `while`.


```r
# Good
if (condition) {
  x + 2
}

# Bad
if(condition){
  x + 2
}
```


---

## Code Blocks

* `{` should be the last character on the line. Related code (e.g., an `if` clause, a function declaration, a trailing comma, ...) must be on the same line as the opening brace. It should be preceded by a single space.


```r
if (condition == TRUE) {
```

--

* The contents within code blocks should be indented by two spaces from where it started


```r
if (condition == TRUE) {
  code_contents
```

--

* `}` should be the first character on the line.


```r
if (condition == TRUE) {
  code_contents 
}
```

---

## Code Blocks


```r
# Good
if (y &lt; 0) {
  message("y is negative")
}

if (y == 0) {
  if (x &gt; 0) {
    log(x)
  } else {
    message("x is negative or zero")
  }
} else {
  y^x
}
```

---

## Code Blocks


```r
# Bad
if (y&lt;0){
message("Y is negative")
}

if (y == 0)
{
    if (x &gt; 0) {
      log(x)
    } else {
  message("x is negative or zero")
    }
} else { 
y ^ x }
```

---

## In-line Statments

In general, it's ok to drop the curly braces for very simple statements that fit on one line. However, function calls that affect control flow (`return`, `stop`, etc.) should always go in their own `{}` block:



```r
# Good
y &lt;- 10
x &lt;- if (y &lt; 20) "Too low" else "Too high"

if (y &lt; 0) {
  stop("Y is negative")
}

find_abs &lt;- function(x) {
  if (x &gt; 0) {
    return(x)
  }
  x * -1
}
```


---


## In-line Statements

In general, it's ok to drop the curly braces for very simple statements that fit on one line. However, function calls that affect control flow (`return`, `stop`, etc.) should always go in their own `{}` block:


```r
# Bad
if (y &lt; 0) stop("Y is negative")

if (y &lt; 0)
  stop("Y is negative")

find_abs &lt;- function(x) {
  if (x &gt; 0) return(x)
  x * -1
}
```


---


## Long lines in functions

If a function definition runs over multiple lines, indent the second line to where the definition starts.


```r
# Good
long_function_name &lt;- function(a = "a long argument",
                               b = "another argument",
                               c = "another long argument") {
  # As usual code is indented by two spaces.
}

# Bad
long_function_name &lt;- function(a = "a long argument",
  b = "another argument",
  c = "another long argument") {
  # Here it's hard to spot where the definition ends and the
  # code begins
}
```

---

## `return`

Strictly speaking, `return` is not necessary in a function definition.
The function will output the last line of executable R code. 
The following function definitions will output the same results!


```r
Add_Values &lt;- function(x, y) {
  return(x + y)
}

Add_Values &lt;- function(x, y) {
  x + y
}
```


Note that our two guides disagree on which of these is preferable. 

Personally, I always make my `return` statements explicit, so I prefer the former.

---

## Commenting functions

For now, when commenting functions, include (at least) 3 lines of comments:

* a comment describing the purpose of a function
* a comment describing each input
* a comment describing the output

The function body should be commented as usual!

---



```r
# Good ----
# Function: square_plus_2, squares a number and then adds 2
# Input: x, must be numeric
# Output: numeric equal to x^2 + 2
square_plus_2 &lt;- function(x) {
  # check that x is numeric
  if (!is.numeric(x)) {
    stop("x must be numeric!")
  } else {
    # if numeric, then square and add 2
    y &lt;- x^2 + 2
    return(y)
  }
}
```

---


```r
# Bad ----
# Function for problem 2c
square_plus_2 &lt;- function(x) {
  if (!is.numeric(x)) {
    stop("x must be numeric!")
  } else {
    y &lt;- x^2 + 2
    return(y)
  }
}
```


---
layout: false

# Summary

* Use `if` and `else` to set conditions
* Use `for` and `while` to write loops
* Functions include a input parameters, a body of code, and an output
* Functions are essential for a good workflow!


---


class: inverse 

.sectionhead[Part 4: Packages]

---
layout: true

# Packages

---

## Today's pet picture 


&lt;img src="../../files/images/pets/happy_puppy.jpg" width="200px" style="display: block; margin: auto;" /&gt;

Thanks Lucy!

---

## What is an R package?

* Packages bundle together code, data, and documentation in an easy to share way.
* They come with functions that others have written for you to make your life easier, 
and greatly improve the power of R! 
* Packages are the reason we are learning about R in this course.
* Packages can range from graphical software, to web scraping tools, statistical models for spatio-temporal data, microbial data analysis tools, and more!


---

## Where are packages?

* The most popular package repository is the Comprehensive R Archive Network, or [CRAN](https://cran.r-project.org/)
* As of making this slide, it includes over 18,000 packages 
* Other popular repositories include [Bioconductor](https://www.bioconductor.org/) and [Github](https://github.com/)

---

## How do I install packages?

If a package is available on CRAN, like most packages we will use for this course,
you can install it using `install.packages()`:


```r
install.packages("PACKAGE_NAME_IN_QUOTES")
```

You can also install by clicking *Install* in the *Packages* tab through RStudio.

For the most part, after you install a package, it is saved on your computer until you update R, and you will not need to re-install it. 
Thus, you should **never** include a call to `install.packages()` in any `.R` or `.Rmd` file!


---

## How do I use a package?

After a package is installed, you can load it into your current R session using `library()`:


```r
library(PACKAGE_NAME)
# or 
library("PACKAGE_NAME")
```

Note that unlike `install.packages()`, you do not need to include the package name in quotes.

---

## How do I use a package?

Loading a package must be done with each new R session, so you should put calls to `library()` in your `.R` and `.Rmd` files.

Usually, I do that in the opening code chunk. If it is a `.Rmd`, I set the parameter
`include = FALSE` to hide the messages and code, because they are usually unnecessary to the reader
of my HTML. 

    ```{r, include = FALSE}
    library(ggplot2)
    ```
    
---
layout: false
class: inverse

.sectionhead[Part 5: Data]

---


# Tibbles

`tibbles` are a special Tidyverse data frame from the `tibble` package. 
You can convert data frames to tibbles using `as_tibble()`, or you can create them similarly 
to data frames using `tibble()`. 
The biggest benefit of tibbles is that they display nicer in your R console, automatically
truncating output and including variable type to print nicely.

Tidyverse has decided rownames are obsolete, and so they do not include rownames 
by default. However, we can include our rownames as a variable using the parameter `rownames` in 
`as_tibble()`.

---


# Tibbles



```r
library(tibble)
my_data &lt;- data.frame("var1" = 1:3,
                      "var2" = c("a", "b", "c"),
                      "var3" = c(TRUE, FALSE, TRUE))
rownames(my_data) &lt;- c("obs1", "obs2", "obs3")
my_data
```

```
##      var1 var2  var3
## obs1    1    a  TRUE
## obs2    2    b FALSE
## obs3    3    c  TRUE
```

```r
my_tibble &lt;- as_tibble(my_data, rownames = "Observation")
my_tibble
```

```
## # A tibble: 3 × 4
##   Observation  var1 var2  var3 
##   &lt;chr&gt;       &lt;int&gt; &lt;fct&gt; &lt;lgl&gt;
## 1 obs1            1 a     TRUE 
## 2 obs2            2 b     FALSE
## 3 obs3            3 c     TRUE
```

---
layout: true 

# Tidy Data Principles

---

There are three rules required for data to be considered tidy

* Each variable must have its own column
* Each observation must have its own row
* Each value must have its own cell

---

Seems simple, but can sometimes be tricky!

What's untidy about the following data?

&lt;table class="table" style="margin-left: auto; margin-right: auto;"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; Hospital &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Diseased &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Healthy &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; A &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 10 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 14 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; B &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 15 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 18 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; C &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 12 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 13 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; D &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 5 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 16 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

Remember, 
* Each variable must have its own column
* Each observation must have its own row
* Each value must have its own cell

---

&lt;table class="table" style="margin-left: auto; margin-right: auto;"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; Hospital &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Diseased &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Healthy &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; A &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 10 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 14 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; B &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 15 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 18 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; C &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 12 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 13 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; D &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 5 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 16 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

* **Observations:** the number of individuals at a given hospital and of a given disease status
* **Variables:** the hospital, the disease status, the counts
* **Values:** Hospital A, Hospital B, Hospital C, Hospital D, individual count values, *Disease Status Healthy*, *Disease Status Diseased*

---

Problem: column headers are values, not variables!

How can we tidy it up?

--

&lt;table class="table" style="margin-left: auto; margin-right: auto;"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; Hospital &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Status &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Count &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; A &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Diseased &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 10 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; A &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Healthy &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 14 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; B &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Diseased &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 15 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; B &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Healthy &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 18 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; C &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Diseased &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 12 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; C &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Healthy &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 13 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; D &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Diseased &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 5 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; D &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Healthy &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 16 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

---

Another example:

&lt;table class="table" style="margin-left: auto; margin-right: auto;"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; Country &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Year &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; m1624 &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; m2534 &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; f1624 &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; f2534 &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; A &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2018 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 49 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 55 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 47 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 41 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; B &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2018 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 34 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 33 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 50 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 43 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

--

* **Observations:** the number of individuals in a given country, in a given year, of a given gender, and in a given age group
* **Variables:** Country, year, gender, age group, counts
* **Values:** Country A, Country B, Year 2018, Gender "m", Gender "f", Age Group "1624", Age Group "2534", individual counts

---

&lt;table class="table" style="margin-left: auto; margin-right: auto;"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; Country &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Year &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Gender &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Age_Group &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Counts &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; A &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2018 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; m &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 16-24 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 49 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; A &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2018 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; m &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 25-34 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 55 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; A &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2018 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; f &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 16-24 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 47 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; A &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2018 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; f &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 25-34 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 41 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; B &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2018 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; m &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 16-24 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 34 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; B &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2018 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; m &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 25-34 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 33 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; B &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2018 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; f &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 16-24 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 50 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; B &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2018 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; f &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 25-34 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 43 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;


---


## How to tidy data?

1. Identify the observations, variables, and values
2. Ensure that each observation has its own row
  * Be careful for individual observations spread over multiple tables/Excel files/etc, or multiple types of observations within a single table (this would result in many empty cells)
3. Ensure that each variable has its own column
  * Be careful for variables spread over two columns, multiple variables within a single column, variables as rows
4. Ensure that each value has its own cell
  * Be careful for values as column headers
  
---

## Why tidy data?

* Easier to read data
* Easier to analyze and plot using standard software (required for `ggplot2`)
* Easier to understand what the data represents
* Fewer issues with missing values

---

## Using R to tidy data


```
## # A tibble: 18 × 11
##    religion `&lt;$10k` `$10-20k` `$20-30k` `$30-40k` `$40-50k` `$50-75k` `$75-100k`
##    &lt;chr&gt;      &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
##  1 Agnostic      27        34        60        81        76       137        122
##  2 Atheist       12        27        37        52        35        70         73
##  3 Buddhist      27        21        30        34        33        58         62
##  4 Catholic     418       617       732       670       638      1116        949
##  5 Don’t k…      15        14        15        11        10        35         21
##  6 Evangel…     575       869      1064       982       881      1486        949
##  7 Hindu          1         9         7         9        11        34         47
##  8 Histori…     228       244       236       238       197       223        131
##  9 Jehovah…      20        27        24        24        21        30         15
## 10 Jewish        19        19        25        25        30        95         69
## 11 Mainlin…     289       495       619       655       651      1107        939
## 12 Mormon        29        40        48        51        56       112         85
## 13 Muslim         6         7         9        10         9        23         16
## 14 Orthodox      13        17        23        32        32        47         38
## 15 Other C…       9         7        11        13        13        14         18
## 16 Other F…      20        33        40        46        49        63         46
## 17 Other W…       5         2         3         4         2         7          3
## 18 Unaffil…     217       299       374       365       341       528        407
## # … with 3 more variables: $100-150k &lt;dbl&gt;, &gt;150k &lt;dbl&gt;,
## #   Don't know/refused &lt;dbl&gt;
```


---
## Using R to tidy data


```
## # A tibble: 180 × 3
##    religion income             frequency
##    &lt;chr&gt;    &lt;chr&gt;                  &lt;dbl&gt;
##  1 Agnostic &lt;$10k                     27
##  2 Agnostic $10-20k                   34
##  3 Agnostic $20-30k                   60
##  4 Agnostic $30-40k                   81
##  5 Agnostic $40-50k                   76
##  6 Agnostic $50-75k                  137
##  7 Agnostic $75-100k                 122
##  8 Agnostic $100-150k                109
##  9 Agnostic &gt;150k                     84
## 10 Agnostic Don't know/refused        96
## # … with 170 more rows
```


---

## A final reference

Hadley Wickham is the ultimate resource on tidy data principles. 
[Here is a fantastic reference going through all these principles in more detail and with more examples.](https://vita.had.co.nz/papers/tidy-data.pdf)

---
layout: false
class: inverse

.sectionhead[Part 6: Managing Data]

---
layout: true

# Working Directory

---

## Seeing your working directory

A **working directory** is the filepath R uses to save and look for data. 
You can check for your current working directory using `getwd()`


```r
getwd()
```

```
## [1] "/Users/sarahteichman/Documents/UW/302/STAT302-WIN2022/files/slides"
```

This location is where R will look by default!

---

## Changing your working directory

You can change your working directory using `setwd()`. 


```r
setwd("/Users/Sarah/Documents")
```

You can use the shorthand `..` to reference a parent directory relative to where you are now.


```r
getwd()
```

```
## [1] "/Users/sarahteichman/Documents/UW/302/STAT302-WIN2022/files/slides"
```

```r
setwd("..")
getwd()
```

```
## [1] "/Users/sarahteichman/Documents/UW/302/STAT302-WIN2022/files"
```

---

## Working directories and R Markdown

Do not change your working directory inside R Markdown files! 
By default, R Markdown sets the filepath they are in as the working directory. 

Changing this can (will) mess up your analysis, and make your work less reproducible.

---

## Saving Data

You can save single R objects as `.rds` files using `saveRDS()`, 
multiple R objects as `.RData` or `.rda` files using `save()`, 
and your entire workspace as `.RData` using `save.image()`.


```r
object1 &lt;- 1:5
object2 &lt;- c("a", "b", "c")
# save only object1
saveRDS(object1, file = "object1_only.rds")
# save object1 and object2
save(object1, object2, file = "both_objects.RData")
# save my entire workspace
save.image(file = "entire_workspace.RData")
```
---

## Saving Data

In general, I recommend using `.RData` for multiple objects, and I recommend against using `save.image()`, basically ever.

`save.image()` should never be a part of your workflow. Personally, I only use it if I need to quickly close R and want to come back to exactly where I was later. (For example, a coffee shop I was working at closed). I will always delete the file later so it does not mess with my workflow.

---

## Loading Data 

You can load `.rds` files using `readRDS()` and `.Rdata` and `.rda` files using `load()`.


```r
# load only object1
readRDS("object1_only.rds")
# load object1 and object2
load("both_objects.RData")
# load my entire workspace
load("entire_workspace.RData")
```


---

## Notes on Saving and Loading R Data

The values in quotes are all filepaths, and by default, R will search for these objects in your current working directory.

You can change where R searches for images by adjusting this filepath. For example, if you save your data in a `Data` subfolder within your working directory, you might try


```r
load("./Data/my_data.RData")
```

---

## Other types of data

Often, you will read and write files as **c**omma **s**eparated **v**alues, or `.csv`. 
You can do this by navigating *File &gt; Import Dataset* in the menu bar, but generally I recommend doing it manually using the `readr` package. You will need to do so if loading data is part of your work flow, such as if it is required for an R Markdown writeup.


```r
library(readr)
# read a .csv file in a "Data" subfolder
read_csv("./Data/file.csv")
# save a .csv file in a "Data" subfolder
write_csv("./Data/data_output.csv")
```


`readr` can also handle many more types of data! See more details about `readr` using the fantastic cheat sheet available [here.](https://rstudio.com/resources/cheatsheets/)

---

## Working Directories Summary

* Working directories are the default filepaths R uses to save and load files
* When working in a `.Rmd`, your default filepath is wherever the `.Rmd` is stored, and you should leave it there
* You can change your working directory with `setwd()`. 
* You can reference your current working directory using `.` and the parent directory of your current working directory using `..` 

For larger analysis projects, I recommend using R projects to automatically manage 
your working directory for you!

---
layout: false
layout: true

# Projects

---

Good file organization requires you to keep all your input data, R scripts, 
output data and results, and figures together. 
You can do this using **Projects**.

You can create a project by going to *File &gt; New Project*. 
If you want your project in a folder you have already created, select *Existing Directory*.
If you want RStudio to automatically make you a new folder with a project, select *New Directory*.

Then select *Empty Project* to create a standard project.
This will create a `.Rproj` file on your computer.

When working with a project, save and manage your work as usual. 
When you close and re-open R, *do so by double-clicking on your `.Rproj` file!*
This will automatically open everything as you left it, except your environment will be fresh, 
helping with reproducibility.

---

## Benefits of Projects

* Automatically manages your working directory, even if you move the project file
* Remembers your working directory and command history, all the files you were working on are still open.
* Helps with reproducibility. You can share R project files and the project will load on other computer exactly as it does on yours.
* Helps keep your separate analyses separate. For example, you won't need to worry if you defined a variable `x` in multiple different analyses
* Easy to integrate with version control such as git (more on this later!)
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "default",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
